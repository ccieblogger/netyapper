# Developer Guide: netyapper

This guide explains how to set up, test, and extend the netyapper environment for local development.

---

## üöÄ Starting the Development Environment

### 1. Prerequisites
- Python 3.10+
- [Poetry](https://python-poetry.org/docs/#installation)
- Docker (for running all services via Compose)

### 2. Clone the Repository
```bash
git clone <your-fork-or-upstream-url>
cd netyapper
```

### 3. Install Python Dependencies
```bash
poetry install
```

### 4. Start the Environment (Recommended: Docker Compose)
```bash
docker compose -f docker-compose.dev.yml up --build
```
- FastAPI app: http://localhost:8000
- PostgreSQL: localhost:5432 (user: postgres, password: postgres, db: netraven)
- Ollama: http://localhost:11434 (optional, for local LLM)

### 5. CLI Usage
```bash
cd cli
python query.py "What interfaces are on router R1?"
```
Or, with Docker Compose:
```bash
docker compose -f docker-compose.dev.yml run --rm app python cli/query.py "What interfaces are on router R1?"
```

---

## üß™ Running Tests

All tests are in the `tests/` directory and use `pytest`.

```bash
PYTHONPATH=. pytest
```

---

## ‚úèÔ∏è Modifying Prompts & Actions

### 1. Edit Supported Actions
- Actions are defined in `actions.yaml` at the project root.
- Each action has a name, description, params, and mcp (target MCP client).

Example:
```yaml
create_device:
  description: Create a new device in the system
  params:
    - device_name
    - device_type
    - location
  mcp: netbox
```

### 2. Prompt Templates
- Prompts are dynamically generated by `core/prompt.py` using the action schema from `actions.yaml`.
- To change prompt structure, edit the `build_prompt` method in `PromptEngine`.
- To test prompt output, run:
```bash
PYTHONPATH=. python3 core/print_example_prompt.py
```

---

## üõ†Ô∏è Adding/Changing MCP Clients
- MCP clients live in `mcp_clients/` (e.g., `netbox_mcp_client.py`).
- To add a new MCP, implement a class with `get_actions()` and `dispatch(action, params)` methods.
- Update `actions.yaml` to reference the new MCP in the `mcp` field.

---

## üìö Additional Notes
- Environment variables can be set in `.env` or via Docker Compose.
- For LLM backend config, see `core/llm_client.py`.
- For API endpoints, see `app/main.py` (FastAPI app).

---

For more details, see the architecture docs in `docs/architecture/`.
